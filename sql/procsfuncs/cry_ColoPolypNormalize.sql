  // ----------------------------------------------------  // User name (OS): NHCR-NHMN ADMINISTRATOR  // Date and time: 11/02/11, 14:00:16  // ----------------------------------------------------  // Method: cry_ColoPolypNormalize  // Description  // Conversion routine to move repeating colo fields into a related many Polyp_II table  //NOTE:  //     When code detects that a Polyp_II record should exist, it checks to see if it has been created already.  //     This step will allow multiple passes through the colo records without duplicating new Polyp_II records.  // Parameters  // ----------------------------------------------------C_LONGINT($i;$recCount_i;$countNewPolypRecs_i)C_TEXT($alertText_t)$alertText_t:="Scan the selected col records and create any necessary Polyp II records?"Fnd_Dlg_Confirm ($alertText_t)If (OK=1)ARRAY TEXT($polypLocList_at;10)ARRAY TEXT($polypSizeList_at;5)$polypLocList_at{1}:="TI"$polypLocList_at{2}:="CE"$polypLocList_at{3}:="AC"$polypLocList_at{4}:="HF"$polypLocList_at{5}:="TC"$polypLocList_at{6}:="SF"$polypLocList_at{7}:="DC"$polypLocList_at{8}:="SG"$polypLocList_at{9}:="RE"$polypLocList_at{10}:="U"$polypSizeList_at{1}:="01"$polypSizeList_at{2}:="02"$polypSizeList_at{3}:="03"$polypSizeList_at{4}:="04"$polypSizeList_at{5}:="05"  //REDUCE SELECTION([colo];100)ÊÊ`for testing$recCount_i:=Records in selection([colo])Fnd_Wnd_Position (Fnd_Wnd_CenterOnWindow)Fnd_Dlg_SetProgress ($recCount_i)Fnd_Dlg_SetText ("Creating new Polyp_II records......")Fnd_Dlg_MessageOpen $countNewPolypRecs_i:=0For ($i;1;$recCount_i)Fnd_Dlg_MessageUpdate ($i)If ((Find in array($polypLocList_at;[colo]p_loc_a)>0) | (Find in array($polypSizeList_at;[colo]p_siz_a)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="A";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="A"[Polyp_II]p_loc:=[colo]p_loc_a[Polyp_II]p_siz:=[colo]p_siz_a[Polyp_II]pt_cb:=[colo]pt_cb_a[Polyp_II]pt_hb:=[colo]pt_hb_a[Polyp_II]pt_hs:=[colo]pt_hs_a[Polyp_II]pt_cs:=[colo]pt_cs_a[Polyp_II]pt_pme:=[colo]pt_pme_a[Polyp_II]pt_pe:=[colo]pt_pe_a[Polyp_II]pt_nr:=[colo]pt_nr_a[Polyp_II]pt_lo:=[colo]pt_lo_a[Polyp_II]pt_o:=[colo]pt_o_aIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_a[Polyp_II]pt_te:=[colo]pt_te_aEnd if [Polyp_II]notes:=""[Polyp_II]p_flat:=[colo]p_flat_aSAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if If ((Find in array($polypLocList_at;[colo]p_loc_b)>0) | (Find in array($polypSizeList_at;[colo]p_siz_b)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="B";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="B"[Polyp_II]p_loc:=[colo]p_loc_b[Polyp_II]p_siz:=[colo]p_siz_b[Polyp_II]pt_cb:=[colo]pt_cb_b[Polyp_II]pt_hb:=[colo]pt_hb_b[Polyp_II]pt_hs:=[colo]pt_hs_b[Polyp_II]pt_cs:=[colo]pt_cs_b[Polyp_II]pt_pme:=[colo]pt_pme_b[Polyp_II]pt_pe:=[colo]pt_pe_b[Polyp_II]pt_nr:=[colo]pt_nr_b[Polyp_II]pt_lo:=[colo]pt_lo_b[Polyp_II]pt_o:=[colo]pt_o_bIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_b[Polyp_II]pt_te:=[colo]pt_te_bEnd if [Polyp_II]notes:=""[Polyp_II]p_flat:=[colo]p_flat_bSAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if If ((Find in array($polypLocList_at;[colo]p_loc_c)>0) | (Find in array($polypSizeList_at;[colo]p_siz_c)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="C";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="C"[Polyp_II]p_loc:=[colo]p_loc_c[Polyp_II]p_siz:=[colo]p_siz_c[Polyp_II]pt_cb:=[colo]pt_cb_c[Polyp_II]pt_hb:=[colo]pt_hb_c[Polyp_II]pt_hs:=[colo]pt_hs_c[Polyp_II]pt_cs:=[colo]pt_cs_c[Polyp_II]pt_pme:=[colo]pt_pme_c[Polyp_II]pt_pe:=[colo]pt_pe_c[Polyp_II]pt_nr:=[colo]pt_nr_c[Polyp_II]pt_lo:=[colo]pt_lo_c[Polyp_II]pt_o:=[colo]pt_o_cIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_c[Polyp_II]pt_te:=[colo]pt_te_cEnd if [Polyp_II]notes:=""[Polyp_II]p_flat:=[colo]p_flat_cSAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if If ((Find in array($polypLocList_at;[colo]p_loc_d)>0) | (Find in array($polypSizeList_at;[colo]p_siz_d)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="D";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="D"[Polyp_II]p_loc:=[colo]p_loc_d[Polyp_II]p_siz:=[colo]p_siz_d[Polyp_II]pt_cb:=[colo]pt_cb_d[Polyp_II]pt_hb:=[colo]pt_hb_d[Polyp_II]pt_hs:=[colo]pt_hs_d[Polyp_II]pt_cs:=[colo]pt_cs_d[Polyp_II]pt_pme:=[colo]pt_pme_d[Polyp_II]pt_pe:=[colo]pt_pe_d[Polyp_II]pt_nr:=[colo]pt_nr_d[Polyp_II]pt_lo:=[colo]pt_lo_d[Polyp_II]pt_o:=[colo]pt_o_dIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_d[Polyp_II]pt_te:=[colo]pt_te_dEnd if [Polyp_II]notes:=""[Polyp_II]p_flat:=[colo]p_flat_dSAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if If ((Find in array($polypLocList_at;[colo]p_loc_e)>0) | (Find in array($polypSizeList_at;[colo]p_siz_e)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="E";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="E"[Polyp_II]p_loc:=[colo]p_loc_e[Polyp_II]p_siz:=[colo]p_siz_e[Polyp_II]pt_cb:=[colo]pt_cb_e[Polyp_II]pt_hb:=[colo]pt_hb_e[Polyp_II]pt_hs:=[colo]pt_hs_e[Polyp_II]pt_cs:=[colo]pt_cs_e[Polyp_II]pt_pme:=[colo]pt_pme_e[Polyp_II]pt_pe:=[colo]pt_pe_e[Polyp_II]pt_nr:=[colo]pt_nr_e[Polyp_II]pt_lo:=[colo]pt_lo_e[Polyp_II]pt_o:=[colo]pt_o_eIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_e[Polyp_II]pt_te:=[colo]pt_te_eEnd if [Polyp_II]notes:=""[Polyp_II]p_flat:=[colo]p_flat_eSAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if If ((Find in array($polypLocList_at;[colo]p_loc_f)>0) | (Find in array($polypSizeList_at;[colo]p_siz_f)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="F";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="F"[Polyp_II]p_loc:=[colo]p_loc_f[Polyp_II]p_siz:=[colo]p_siz_f[Polyp_II]pt_cb:=[colo]pt_cb_f[Polyp_II]pt_hb:=[colo]pt_hb_f[Polyp_II]pt_hs:=[colo]pt_hs_f[Polyp_II]pt_cs:=[colo]pt_cs_f[Polyp_II]pt_pme:=[colo]pt_pme_f[Polyp_II]pt_pe:=[colo]pt_pe_f[Polyp_II]pt_nr:=[colo]pt_nr_f[Polyp_II]pt_lo:=[colo]pt_lo_f[Polyp_II]pt_o:=[colo]pt_o_fIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_f[Polyp_II]pt_te:=[colo]pt_te_fEnd if [Polyp_II]notes:=""[Polyp_II]p_flat:=[colo]p_flat_fSAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if If ((Find in array($polypLocList_at;[colo]p_loc_g)>0) | (Find in array($polypSizeList_at;[colo]p_siz_g)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="G";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="G"[Polyp_II]p_loc:=[colo]p_loc_g[Polyp_II]p_siz:=[colo]p_siz_g[Polyp_II]pt_cb:=[colo]pt_cb_g[Polyp_II]pt_hb:=[colo]pt_hb_g[Polyp_II]pt_hs:=[colo]pt_hs_g[Polyp_II]pt_cs:=[colo]pt_cs_g[Polyp_II]pt_pme:=[colo]pt_pme_g[Polyp_II]pt_pe:=[colo]pt_pe_g[Polyp_II]pt_nr:=[colo]pt_nr_g[Polyp_II]pt_lo:=[colo]pt_lo_g[Polyp_II]pt_o:=[colo]pt_o_gIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_g[Polyp_II]pt_te:=[colo]pt_te_gEnd if [Polyp_II]notes:=""[Polyp_II]p_flat:=[colo]p_flat_gSAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if If ((Find in array($polypLocList_at;[colo]p_loc_h)>0) | (Find in array($polypSizeList_at;[colo]p_siz_h)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="H";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="H"[Polyp_II]p_loc:=[colo]p_loc_h[Polyp_II]p_siz:=[colo]p_siz_h[Polyp_II]pt_cb:=[colo]pt_cb_h[Polyp_II]pt_hb:=[colo]pt_hb_h[Polyp_II]pt_hs:=[colo]pt_hs_h[Polyp_II]pt_cs:=[colo]pt_cs_h[Polyp_II]pt_pme:=[colo]pt_pme_h[Polyp_II]pt_pe:=[colo]pt_pe_h[Polyp_II]pt_nr:=[colo]pt_nr_h[Polyp_II]pt_lo:=[colo]pt_lo_h[Polyp_II]pt_o:=[colo]pt_o_hIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_h[Polyp_II]pt_te:=[colo]pt_te_hEnd if [Polyp_II]notes:=""SAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if If ((Find in array($polypLocList_at;[colo]p_loc_i)>0) | (Find in array($polypSizeList_at;[colo]p_siz_i)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="I";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="I"[Polyp_II]p_loc:=[colo]p_loc_i[Polyp_II]p_siz:=[colo]p_siz_i[Polyp_II]pt_cb:=[colo]pt_cb_i[Polyp_II]pt_hb:=[colo]pt_hb_i[Polyp_II]pt_hs:=[colo]pt_hs_i[Polyp_II]pt_cs:=[colo]pt_cs_e[Polyp_II]pt_pme:=[colo]pt_pme_i[Polyp_II]pt_pe:=[colo]pt_pe_i[Polyp_II]pt_nr:=[colo]pt_nr_i[Polyp_II]pt_lo:=[colo]pt_lo_i[Polyp_II]pt_o:=[colo]pt_o_eIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_i[Polyp_II]pt_te:=[colo]pt_te_iEnd if [Polyp_II]notes:=""SAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if If ((Find in array($polypLocList_at;[colo]p_loc_j)>0) | (Find in array($polypSizeList_at;[colo]p_siz_j)>0))QUERY([Polyp_II];[Polyp_II]old_polyp_id="J";*)QUERY([Polyp_II]; & ;[Polyp_II]visit_id=[colo]visit_id)If (Records in selection([Polyp_II])=0)CREATE RECORD([Polyp_II])  //[Polyp_II]polyp_ii_key_id:=`do this in the [Polyp_II] TMethod[Polyp_II]visit_id:=[colo]visit_id[Polyp_II]old_polyp_id:="J"[Polyp_II]p_loc:=[colo]p_loc_j[Polyp_II]p_siz:=[colo]p_siz_j[Polyp_II]pt_cb:=[colo]pt_cb_j[Polyp_II]pt_hb:=[colo]pt_hb_j[Polyp_II]pt_hs:=[colo]pt_hs_j[Polyp_II]pt_cs:=[colo]pt_cs_j[Polyp_II]pt_pme:=[colo]pt_pme_j[Polyp_II]pt_pe:=[colo]pt_pe_j[Polyp_II]pt_nr:=[colo]pt_nr_j[Polyp_II]pt_lo:=[colo]pt_lo_j[Polyp_II]pt_o:=[colo]pt_o_eIf ([colo]barcode="Q@")[Polyp_II]pt_sn:=[colo]pt_sn_j[Polyp_II]pt_te:=[colo]pt_te_jEnd if [Polyp_II]notes:=""SAVE RECORD([Polyp_II])$countNewPolypRecs_i:=$countNewPolypRecs_i+1End if End if NEXT RECORD([colo])End for Fnd_Dlg_MessageClose Fnd_Dlg_Alert (String($countNewPolypRecs_i)+" new Polyp_II records were created.")UNLOAD RECORD([colo])UNLOAD RECORD([polyp])End if   //That's all, folks!