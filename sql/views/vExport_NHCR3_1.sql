create view vExport_NHCR3_1 as select
row_number() over() as row_num,
e.event_id as e_event_id,
p.person_id,
p2_event_id,
e.person_id as e_person_id,
c_event_id,
s_event_id,
a.specimen_id,
pr.event_id as pr_event_id,
sv.event_id as sv_event_id,
fu.fu_event_id,
a.abort_reas_obs,
a.abort_reas_oth,
a.abort_reas_pp,
a.abort_reas_sedprob,
a.abort_reas_tc,
pr.ad_det_manual,
a.addl_polyp as addl_polyps,
pr.adenoma_detected,
sv.alcohol,
a.all_plps_rem,
pr.amended_path_report,
a.anallevel,
pr.APC,
sv.aspirin,
sv.aspirin_duration,
e.batch_id,
pr.case_no,
en.comments,
a.comp_bleed,
a.comp_cardio,
a.comp_none,
a.comp_oth,
a.comp_perf,
a.comp_resparr,
a.computed_fnd_polyp,
a.computed_fnd_siz,
a.computed_normal_exam,
a.computed_plp_trtmnt,
a.computed_susp_ca,
a.computed_susp_ca_loc,
a.computed_susp_ca_siz,
a.computed_susp_ca_trtmnt,
a.computed_susp_crohn,
a.computed_susp_other,
a.computed_susp_uc,
pr.consult,
pr.consult_date,
a.container,
sv.coumadin,
sv.curr_ht_ft,
sv.curr_ht_in,
sv.curr_wt,
a.data_source,
p.deceased,
p.deceased_date,
pg.degree,
a.dex_abd_pain,
a.dex_abn_test,
a.dex_abn_tst_bar_en,
a.dex_abn_tst_ctc,
a.dex_abn_tst_oth,
a.dex_biop,
a.dex_bleed,
a.dex_cbh_cons,
a.dex_cbh_diar,
a.dex_cbh_diarcons,
a.dex_elim_ibd,
a.dex_fobt,
a.dex_ida,
a.dex_oth,
a.dex_plpect_plp,
a.discrepnote,
e.disabled,
p.dob,
sv.education,
a.end_proc_stat_rr,
e.endo_barcode as barcode_endoform,
e.endo_code,
a.endo_code as endoscopist_id_cprs,
en.endo_degree,
en.endo_dob,
en.endo_fellow_discipline,
en.endo_fellow_grad_year,
en.endo_fellowship,
e.endo_form_double_entered,
en.endo_gender_male,
en.endo_med_grad_year,
en.endo_pseudo_name,
en.endo_res_grad_year,
en.endo_specialty,
en.endo_status,
en.endo_status_date,
en.enroll_survey_done,
e.event_date,
e.event_type,
sv.ever_cplp,
sv.ever_cplp_fam,
sv.ever_fap,
sv.ever_hnpcc,
sv.ever_ibs,
sv.evr_crc_tab,
sv.exercise,
sv.ext_calcium,
sv.ext_calcium_daration as ext_calcium_duration,
a.f_reas_curex,
a.f_reas_famhx,
a.f_reas_ibd,
a.f_reas_oth,
a.f_reas_perhx,
f.facility_id,
f.facility_name,
f.facility_pseudo_name,
a.find_calc_cancer,
a.find_calc_nodata,
a.find_calc_normal,
a.find_calc_other,
a.find_calc_polyp,
a.find_oth_biop,
a.find_oth_bmc,
a.find_oth_ibd,
a.find_oth_other,
a.find_other,
a.flg_assump,
a.flg_assump_numpolyps,
a.flg_dx,
a.flg_dx_multis,
a.flg_dx_site,
a.flg_dx_size,
a.flg_multis,
a.flg_multisites,
a.flg_no_discrep,
a.flg_no_path_spec,
a.flg_no_Q_spec,
a.flg_noQdata,
a.flg_num_polyps,
a.flg_path_sites,
a.flg_residual,
a.flg_review,
a.flg_site_discrep,
a.flg_site_uncert,
a.flg_size_discrep,
a.fnd_norm_ex,
a.fnd_plp as find_plp,
sv.foreign_born,
fu.follow_up_id,
fu.fu_colo_rec,
fu.fu_date,
fu.fu_docrecfut,
fu.fu_docrecscrn,
fu.fu_embarss,
fu.fu_explain,
fu.fu_feelgood,
a.fu_form_completed,
fu.fu_lschncdy,
fu.fu_noworry,
fu.fu_nrvs,
fu.fu_pain,
fu.fu_person_id,
fu.fu_plp_ltr,
fu.fu_plp_ltr_info,
fu.fu_plp_rem,
fu.fu_prep,
fu.fu_pstcmp_bleed,
fu.fu_pstcmp_gas,
fu.fu_pstcmp_none,
fu.fu_pstcmp_oth,
fu.fu_pstcmp_perf,
fu.fu_pstcmp_react,
fu.fu_quality,
fu.fu_scrn,
fu.fu_teleform_formid,
fu.fu_toolong,
a.fup_10,
a.fup_1t3,
a.fup_2t3,
a.fup_4t5,
a.fup_6t10,
a.fup_6t9,
a.fup_baren,
a.fup_ctc,
a.fup_gt10,
a.fup_lt1,
a.fup_nfsi,
a.fup_othproc,
a.fup_pcp,
a.fup_pp,
a.fup_rwp,
a.fup_surgcons,
pr.gender,
p.gender_calcd,
sv.health,
a.HGD,
sv.hispanic,
a.ibd_actcol,
a.ibd_chroncol,
a.ibd_coloth,
a.ibd_ibd,
a.ibd_inactcol,
a.ibd_lgdysp,
a.ibdtyp_crohn,
a.ibdtyp_ind,
a.ibdtyp_uc,
f.implementation_date,
a.ind_diag_exam,
a.ind_scr_fhxcc,
a.ind_scr_fhxcc_fdr,
a.ind_scr_fhxplp,
a.ind_scr_nosym,
a.ind_scr_phxcca,
a.ind_sur_fhnpcc,
a.ind_sur_ibd,
a.ind_sur_phxcc,
a.ind_sur_phxplp,
a.ind_sur_phxplpcca,
a.indication_calculated,
sv.ins_hmo,
sv.ins_mcaid,
sv.ins_mcare,
sv.ins_none,
sv.ins_oth,
sv.ins_priv,
sv.ins_unsure,
pr.lab_code,
pl.lab_name,
sv.marital_status,
a.meds_used_demerol,
a.meds_used_fentanyl,
a.meds_used_none
from event e
join person p ON e.person_id = p.person_id
left outer join vAll a on a.event_id = e.event_id
left outer join path_report pr ON pr.event_id = e.event_id
left outer join survey sv ON sv.event_id = e.event_id
left outer join vfollow_up fu ON e.event_id = fu.fu_event_id
left outer join endoscopist en ON e.endo_code = en.endoscopist_id
left outer join pathologist pg ON pr.pathologist_code_cprs = pg.pathologist_code
left outer join facility f ON a.facility_id = f.facility_id
left outer join path_lab pl ON pr.lab_code = pl.lab_code
where (refused = 0 or refused is null) and event_date >= '2004-01-01'
order by row_num;
